(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{835:function(s,a,t){"use strict";t.r(a);var e=t(4),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("Generated by ChatGPT and sifu on 2024-12-07. 已验证可行性~")])]),s._v(" "),t("h2",{attrs:{id:"_1、目标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、目标"}},[s._v("#")]),s._v(" 1、目标")]),s._v(" "),t("p",[s._v("在 A 服务器上通过 SSH 执行 B 服务器中的某个脚本")]),s._v(" "),t("h2",{attrs:{id:"_2、步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、步骤"}},[s._v("#")]),s._v(" 2、步骤")]),s._v(" "),t("h3",{attrs:{id:"步骤-1-在a服务器上生成-ssh-密钥-如果尚未生成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#步骤-1-在a服务器上生成-ssh-密钥-如果尚未生成"}},[s._v("#")]),s._v(" 步骤 1: 在A服务器上生成 SSH 密钥（如果尚未生成）")]),s._v(" "),t("p",[s._v("如果 A 服务器上尚未生成 SSH 密钥，请使用以下命令生成一个新的 SSH 密钥对：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ssh-keygen -t rsa -b "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("按提示操作，您可以选择保存位置（默认是 ~/.ssh/id_rsa）和设置密码（可以留空）。")]),s._v(" "),t("h3",{attrs:{id:"步骤-2-获取公钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#步骤-2-获取公钥"}},[s._v("#")]),s._v(" 步骤 2: 获取公钥")]),s._v(" "),t("p",[s._v("在 A 服务器上，获取生成的公钥内容。可以使用以下命令查看公钥：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.ssh/id_rsa.pub\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("复制输出的内容（以 ssh-rsa 开头的整行）。")]),s._v(" "),t("h3",{attrs:{id:"步骤-3-将公钥添加到-b-服务器的-authorized-keys-中"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#步骤-3-将公钥添加到-b-服务器的-authorized-keys-中"}},[s._v("#")]),s._v(" 步骤 3: 将公钥添加到 B 服务器的 authorized_keys 中")]),s._v(" "),t("p",[s._v("SSH 登录到 B 服务器：")]),s._v(" "),t("p",[s._v("使用您的 SSH 配置文件连接到 B 服务器：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@myserver\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("编辑 authorized_keys 文件：")]),s._v(" "),t("p",[s._v("在 B 服务器上，执行以下命令打开 authorized_keys 文件（如果文件不存在，会自动创建）：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" ~/.ssh/authorized_keys\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("或者使用您喜欢的文本编辑器，例如 vi 或 vim。")]),s._v(" "),t("p",[s._v("粘贴公钥：")]),s._v(" "),t("p",[s._v("将从 A 服务器复制的公钥粘贴到 authorized_keys 文件的末尾。确保每个密钥都在单独的一行中。")]),s._v(" "),t("p",[s._v("保存并退出：")]),s._v(" "),t("p",[s._v("如果您使用 nano，可以按 CTRL + X，然后按 Y 保存更改，最后按 ENTER 退出。如果使用 vi，可以按 ESC，输入 :wq，然后按 ENTER 。")]),s._v(" "),t("h3",{attrs:{id:"步骤-4-设置权限-如果需要"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#步骤-4-设置权限-如果需要"}},[s._v("#")]),s._v(" 步骤 4: 设置权限（如果需要）")]),s._v(" "),t("p",[s._v("确保 .ssh 目录和 authorized_keys 文件的权限设置正确。可以使用以下命令进行设置：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" ~/.ssh\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" ~/.ssh/authorized_keys\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"步骤-5-测试-ssh-连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#步骤-5-测试-ssh-连接"}},[s._v("#")]),s._v(" 步骤 5: 测试 SSH 连接")]),s._v(" "),t("p",[s._v("现在返回 A 服务器，尝试使用 SSH 连接到 B 服务器，检查是否能够无密码登录：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@myserver\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果一切正常，您应该能够成功登录而无需输入密码。这意味着 A 服务器的 SSH 密钥已成功添加到 B 服务器的 ~/.ssh/authorized_keys 中。")]),s._v(" "),t("h3",{attrs:{id:"步骤-6-远程执行脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#步骤-6-远程执行脚本"}},[s._v("#")]),s._v(" 步骤 6: 远程执行脚本")]),s._v(" "),t("h4",{attrs:{id:"方式一-在-a-服务器上-使用以下命令执行-a-服务器中的脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方式一-在-a-服务器上-使用以下命令执行-a-服务器中的脚本"}},[s._v("#")]),s._v(" 方式一： 在 A 服务器上，使用以下命令执行 A 服务器中的脚本：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@myserver "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bash -s'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" script.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这一步中，'bash -s' 是一个特殊参数，它将导致远程服务器执行一个 bash 命令，而不需要输入任何命令。然后，< script.sh> 是一个文件名，它指定了要执行的脚本。")]),s._v(" "),t("h4",{attrs:{id:"方式二-在-a-服务器上-使用以下命令执行-b-服务器中的脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方式二-在-a-服务器上-使用以下命令执行-b-服务器中的脚本"}},[s._v("#")]),s._v(" 方式二： 在 A 服务器上，使用以下命令执行 B 服务器中的脚本：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@myserver script.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[t("strong",[s._v("注意：")])]),s._v(" "),t("p",[s._v("第一种方式（"),t("code",[s._v("ssh root@myserver 'bash -s' < script.sh")]),s._v("）适用于在本地编辑并执行脚本，而不需要在远程服务器上存在脚本文件。")]),s._v(" "),t("p",[s._v("第二种方式（"),t("code",[s._v("ssh root@myserver script.sh")]),s._v("）要求脚本已存在于远程服务器上并具备执行权限。")])])])}),[],!1,null,null,null);a.default=r.exports}}]);